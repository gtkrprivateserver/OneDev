<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ONEDEV Creator</title>

  <!-- Styles global -->
  <link rel="stylesheet" href="../styles.css">

  <!-- Styles khusus creator -->
  <link rel="stylesheet" href="../content/creator.css">

  <style>
    /* FIX LOGIN TIDAK BISA DIKLIK */
    header, .header-right, .btn-login {
      position: relative;
      z-index: 3000 !important;
    }

    #adsContainer { pointer-events: none; }
    .main-content { position: relative; z-index: 2; }
  </style>
</head>

<body>

<!-- Banner otomatis -->
<div id="adsContainer"></div>

<!-- Sidebar otomatis melalui sidebar.js -->

<div class="main-content">

  <header>
    <div class="header-left">
      <button id="menuBtn" class="menu-btn">☰</button>
      <h1>Creator Dashboard</h1>
    </div>

    <div class="header-right">
      <button class="btn-login" id="loginBtn">Login</button>
      <button class="btn-logout" id="logoutBtn" style="display:none;">Logout</button>

      <!-- Tombol upload setelah login -->
      <button class="btn-upload" id="openUploadBtn" style="display:none;">Upload</button>
    </div>
  </header>

  <section class="creator-container">

    <!-- LOGIN POPUP -->
    <div class="creator-login-overlay" id="loginOverlay">
      <div class="creator-login-popup">
        <h2>Masuk sebagai Creator</h2>
        <p>Silakan login untuk upload video.</p>

        <input type="text" id="username" placeholder="Username creator">
        <input type="password" id="password" placeholder="Password">

        <button class="btn-primary" id="submitLogin">Login</button>
        <button class="btn-close" id="closeLoginPopup">Tutup</button>
      </div>
    </div>

    <!-- DASHBOARD -->
    <div class="creator-dashboard" id="dashboard" style="display:none;">

      <!-- UPLOAD POPUP -->
      <div class="upload-overlay" id="uploadOverlay">
        <div class="upload-popup">
          <h2>Upload Video Baru</h2>

          <form id="uploadForm">
            <label>Judul Video</label>
            <input type="text" id="videoTitle" required>

            <label>Thumbnail</label>
            <input type="file" id="thumbFile" accept="image/*" required>

            <label>Video File</label>
            <input type="file" id="videoFile" accept="video/*" required>

            <button type="submit" class="btn-primary">Upload</button>
            <button type="button" class="btn-close" id="closeUploadPopup">Batal</button>
          </form>
        </div>
      </div>

      <h2>Video Anda</h2>

      <div class="creator-video-grid" id="videoList">
        <!-- Video muncul otomatis -->
      </div>

    </div>

  </section>

</div>

<!-- VIDEO PLAYER POPUP -->
<div id="playerOverlay" class="player-overlay" style="display:none;">
  <div class="player-box">
    <button class="player-close" id="closePlayer">Tutup</button>
    <h2 id="playerTitle"></h2>

    <video id="playerVideo" controls></video>

    <div class="stats" id="playerStats"></div>

    <!-- Like -->
    <button class="like-btn" id="likeBtn">Like ❤️</button>

    <!-- Comments -->
    <h3>Komentar</h3>
    <div id="commentList"></div>

    <textarea id="commentInput" placeholder="Tulis komentar..."></textarea>
    <button class="like-btn" id="submitComment">Kirim</button>
  </div>
</div>

<script src="../sidebar.js"></script>

<script>
/* ======================================================
                LOGIN SYSTEM
======================================================*/
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const loginOverlay = document.getElementById("loginOverlay");
const submitLogin = document.getElementById("submitLogin");
const closeLoginPopup = document.getElementById("closeLoginPopup");

const dashboard = document.getElementById("dashboard");
const openUploadBtn = document.getElementById("openUploadBtn");

loginBtn.onclick = () => loginOverlay.style.display = "flex";
closeLoginPopup.onclick = () => loginOverlay.style.display = "none";

submitLogin.onclick = () => {
    const user = document.getElementById("username").value.trim();
    const pass = document.getElementById("password").value.trim();

    if (user.length > 0 && pass.length > 0) {
        loginOverlay.style.display = "none";
        dashboard.style.display = "block";
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
        openUploadBtn.style.display = "inline-block";

        localStorage.setItem("creator_login", "true");
    } else {
        alert("Isi semua field!");
    }
};

logoutBtn.onclick = () => {
    localStorage.removeItem("creator_login");
    dashboard.style.display = "none";
    loginBtn.style.display = "inline-block";
    logoutBtn.style.display = "none";
    openUploadBtn.style.display = "none";
};

/* Auto login restore */
if (localStorage.getItem("creator_login") === "true") {
    dashboard.style.display = "block";
    loginBtn.style.display = "none";
    logoutBtn.style.display = "inline-block";
    openUploadBtn.style.display = "inline-block";
}

/* ======================================================
                UPLOAD VIDEO
======================================================*/
const uploadOverlay = document.getElementById("uploadOverlay");
const uploadForm = document.getElementById("uploadForm");
const videoList = document.getElementById("videoList");
const closeUploadPopup = document.getElementById("closeUploadPopup");

openUploadBtn.onclick = () => uploadOverlay.style.display = "flex";
closeUploadPopup.onclick = () => uploadOverlay.style.display = "none";

uploadForm.addEventListener("submit", (e) => {
    e.preventDefault();

    const title = document.getElementById("videoTitle").value.trim();
    const thumbFile = document.getElementById("thumbFile").files[0];
    const videoFile = document.getElementById("videoFile").files[0];

    if (!thumbFile || !videoFile) {
        alert("Thumbnail & video wajib dipilih!");
        return;
    }

    const readerThumb = new FileReader();
    const readerVideo = new FileReader();

    readerThumb.onload = (e1) => {
        const thumbURL = e1.target.result;

        readerVideo.onload = (e2) => {
            const videoURL = e2.target.result;

            const videoData = {
                id: Date.now(),
                title,
                thumbURL,
                videoURL,
                views: 0,
                likes: 0,
                comments: []
            };

            saveVideo(videoData);
            showVideo(videoData);

            uploadOverlay.style.display = "none";
            uploadForm.reset();
        };

        readerVideo.readAsDataURL(videoFile);
    };

    readerThumb.readAsDataURL(thumbFile);
});

/* ======================================================
               SAVE & LOAD VIDEO STORAGE
======================================================*/
function saveVideo(obj) {
    let data = JSON.parse(localStorage.getItem("videos") || "[]");
    data.push(obj);
    localStorage.setItem("videos", JSON.stringify(data));
}

function loadVideos() {
    let data = JSON.parse(localStorage.getItem("videos") || "[]");
    data.forEach(showVideo);
}

loadVideos();

/* ======================================================
               TAMPILKAN VIDEO LIST
======================================================*/
function showVideo(v) {
    const box = document.createElement("div");
    box.className = "creator-video-box";

    box.innerHTML = `
        <img src="${v.thumbURL}" class="creator-thumb" onclick="openPlayer(${v.id})">
        <h3>${v.title}</h3>
        <div class="stats">
            <span>${v.views}x ditonton</span>
            <span>${v.likes} like</span>
        </div>
    `;

    videoList.appendChild(box);
}

/* ======================================================
               VIDEO PLAYER POPUP
======================================================*/
const playerOverlay = document.getElementById("playerOverlay");
const playerVideo = document.getElementById("playerVideo");
const playerTitle = document.getElementById("playerTitle");
const playerStats = document.getElementById("playerStats");
const likeBtn = document.getElementById("likeBtn");
const closePlayer = document.getElementById("closePlayer");
const commentList = document.getElementById("commentList");
const commentInput = document.getElementById("commentInput");
const submitComment = document.getElementById("submitComment");

let currentVideo = null;

function openPlayer(id) {
    let data = JSON.parse(localStorage.getItem("videos") || "[]");
    let v = data.find(x => x.id === id);
    currentVideo = v;

    if (!v) return;

    v.views++;
    localStorage.setItem("videos", JSON.stringify(data));

    playerVideo.src = v.videoURL;
    playerTitle.innerText = v.title;
    playerStats.innerHTML = `${v.views} views • ${v.likes} likes`;

    loadComments(v);

    playerOverlay.style.display = "flex";
}

closePlayer.onclick = () => {
    playerOverlay.style.display = "none";
    playerVideo.pause();
};

/* LIKE */
likeBtn.onclick = () => {
    let data = JSON.parse(localStorage.getItem("videos") || "[]");
    let v = data.find(x => x.id === currentVideo.id);

    v.likes++;

    localStorage.setItem("videos", JSON.stringify(data));
    playerStats.innerHTML = `${v.views} views • ${v.likes} likes`;

    loadVideoListAgain();
};

/* COMMENT */
submitComment.onclick = () => {
    const msg = commentInput.value.trim();
    if (msg.length === 0) return;

    let data = JSON.parse(localStorage.getItem("videos") || "[]");
    let v = data.find(x => x.id === currentVideo.id);

    v.comments.push(msg);
    localStorage.setItem("videos", JSON.stringify(data));

    commentInput.value = "";
    loadComments(v);
};

function loadComments(v) {
    commentList.innerHTML = "";
    v.comments.forEach(c => {
        const p = document.createElement("p");
        p.innerText = c;
        commentList.appendChild(p);
    });
}

/* Refresh list setelah like */
function loadVideoListAgain() {
    videoList.innerHTML = "";
    loadVideos();
}

</script>

</body>
</html>